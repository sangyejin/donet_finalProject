<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="fundingMapper">
	
	<!-- 펀딩 카테고리 -->
	<resultMap id="fundingCategoryResultSet" type="FundingCategory">
		<id property="categoryNo" column="FUNDING_CATEGORY_NO" />
		<result property="categoryName" column="FUNDING_CATEGORY_NAME" />
	</resultMap>
	<!-- 펀딩 프로젝트 -->
	<resultMap id="fundingResultSet" type="Funding">
		<id property="fpNo" column="FP_NO" />
		<result property="fpName" column="FP_NAME" />
		<result property="hostName" column="USER_NAME" />
		<result property="goal" column="GOAL" />
		<result property="raised" column="RAISED" />
		<result property="hostId" column="HOST_ID" />
		<result property="startDate" column="START_DATE" />
		<result property="closeDate" column="CLOSING_DATE" />
		<result property="content" column="CONTENT" />
		<result property="paymentDate" column="PAYMENT_DATE" />
		<result property="categoryName" column="FUNDING_CATEGORY_NAME" />
		<result property="categoryNo" column="CATEGORY_NO" />
		<result property="hits" column="HITS" />
		<result property="status" column="STATUS" />
		<result property="thumbnailOriginName" column="THUMBNAIL_ORIGIN_NAME" />
		<result property="thumbnailChangeName" column="THUMBNAIL_CHANGE_NAME" />
		<result property="fpWriteDate" column="FP_WRITE_DATE" />
	</resultMap>
	
	<!-- 펀딩 이미지 -->
	<resultMap id="fundingImageResultSet" type="FundingImage">
		<id property="fpNo" column="FP_NO" />
		<id property="imgNo" column="IMG_NO" />
		<result property="imgOriginName" column="IMG_ORIGIN_NAME" />
		<result property="imgChangeName" column="IMG_CHANGE_NAME" />
	</resultMap>
	
	<select id="selectFundingListCount" resultType="_int">
		select COUNT(*)
		from FUNDING_PROJECT
		where STATUS='Y'
	</select>
	
	<select id="selectFundingList" resultMap="fundingResultSet">
		select FP_NO, FP_NAME, B.USER_NAME, GOAL,RAISED, START_DATE, CLOSING_DATE
    		, A.CATEGORY_NO, HITS, THUMBNAIL_ORIGIN_NAME
    		, THUMBNAIL_CHANGE_NAME, C.FUNDING_CATEGORY_NAME
		from FUNDING_PROJECT A
			join MEMBER B on A.HOST_ID=B.USER_ID
			join FUNDING_CATEGORY C on A.CATEGORY_NO = C.FUNDING_CATEGORY_NO
		where A.STATUS='Y'
	</select>
	
	<select id="selectFundingCategoryList" resultMap="fundingCategoryResultSet">
		select FUNDING_CATEGORY_NO, FUNDING_CATEGORY_NAME
		from FUNDING_CATEGORY
	</select>
	
	<insert id="insertFunding" parameterType="Funding">
		<selectKey keyProperty="fpNo" resultType="int" order="AFTER">
			select seq_funding_project.currval from dual
		</selectKey>
		
		insert into FUNDING_PROJECT
		values
		(	
			seq_funding_project.nextval,#{fpName},#{hostId},#{goal}
			,#{raised},TO_DATE(#{startDate}),TO_DATE(#{closeDate})
			,#{content},TO_DATE(#{paymentDate}),#{categoryNo},#{hits}
			,#{status},#{thumbnailOriginName},#{thumbnailChangeName},SYSDATE
		)

	</insert>
	
	<insert id="insertFundingImgList" parameterType="java.util.List">
		insert into FUNDING_IMAGE(FP_NO, IMG_NO, IMG_ORIGIN_NAME, IMG_CHANGE_NAME)
		<foreach collection="list" item="item" separator=" UNION ALL ">
			select #{item.fpNo},#{item.imgNo},#{item.imgOriginName},#{item.imgChangeName} from DUAL
		</foreach>
	</insert>
	

	
</mapper>
